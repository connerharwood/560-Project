---
title: 'Stage 2: Draft Exploratory Analysis'
author: "Ellie Hall and Conner Harwood"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Topic and Motivation

We are looking at how water usage and water-related land use changes in Utah counties lying within the Great Salt Lake Basin have contributed to variations in Great Salt Lake (GSL) water levels. We'll also be using predictive analysis to look at potential future changes to GSL levels using water use trends, changes in water-related land use, and population trends. The specific counties we're focusing on, which lie fully or mostly within the GSL Basin, are Box Elder, Cache, Davis, Morgan, Rich, Salt Lake, Tooele, Utah, and Weber.

Utah has been the [fastest growing state since 2010](https://worldpopulationreview.com/state-rankings/fastest-growing-states), and much of this growth comes in counties closely connected to the Great Salt Lake. The GSL has also been facing dangerously low and decreasing water levels over the past several decades. If this trend continues, the economic, environmental, and ecological consequences to the region would be drastic. Thus, it's important to understand how water use in the Great Salt Lake Basin faced with population pressures will impact the health and future of the Great Salt Lake and its surrounding communities. 

Furthermore, agriculture is the largest water user in the state of Utah, using 68% of the state's water supply, yet only generates 0.2% of Utah's GDP [source](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&ved=2ahUKEwjU4_Tf8aOCAxU9MjQIHS19CYEQFnoECA4QAw&url=https%3A%2F%2Fcontent.csbs.utah.edu%2F~lozada%2FResearch%2FUtahAgWaterUseHay.docx%23%3A~%3Atext%3DUsing%252068%2525%2520of%2520Utah%27s%2520water%2Cto%2520which%2520we%2520will%2520return.&usg=AOvVaw0IdpqkRNtyRjWG_ycnpIPq&opi=89978449). Thus, itâ€™s important to understand the economic consequences of water use in this sector in order to better manage its use.


# Data Descriptions

**Water Use**
Obtained through the Utah Division of Water Rights [here](https://waterrights.utah.gov/asp_apps/generalWaterUse/WaterUseList.asp), this data includes all water rights holders in Utah dating back to 1959. It has records on total monthly water usage in gallons for each water user, and breaks down this usage by type of use (e.g. agricultural, commercial, water supplier), as well as several other variables of interest. It also has latitude and longitude information for most water users, which we may use at some point in the project for spatial analysis. We're looking at data on water usage in the 9 GSL Basin counties.

**Great Salt Lake Elevation Levels**
Obtained through the USGS using the `dataRetrieval` package in R, we've gathered daily water level observations dating back to 1966. The two relevant gauges are the Saltair Boat Harbor gauge in the South arm of the lake, and the gauge near Saline, UT in the North arm (the lake was essentially split into two by a railroad causeway in the 1950s). Though the water levels of the two arms are typically very similar, we've used the average of the two gauge values for our observations. The gauges measure surface level elevation above sea level in feet.

**Water-Related Land Use**
Obtained through the Utah Division of Water Resources [here](https://dwre-utahdnr.opendata.arcgis.com/pages/wrlu-data), this data includes yearly composition of water-related land use by county and by basin. Each observation in a given year contains the acreage of a specific plot of land area as well as a description of the type of water use on that land (e.g. crop type, urban use, pasture).

**County Resident Populations**
Obtained through Federal Reserve Economic Data (FRED) [here](https://fred.stlouisfed.org/categories/30154), it has yearly resident population numbers for each Utah county dating back to 1970.

**Precipitation Data**

# Data Processing

**Water Use**
The water use .csv files for each of the 9 counties included two data tables containing different variables and information on entities with water user rights. One of the tables contained the monthly water usage data we're interested, and the other table had county information which we merged with the first table after cleaning them both. The main cleaning needed with this data was selecting and renaming the relevant variables, addressing NA values, and merging into one dataset with the population data. The data was also converted from wide to long format by monthly water use. Observations missing year, as well as those containing no water usage values, were removed. Some of the latitude/longitude entries were 0, which we converted to NA.

**Great Salt Lake Elevation Levels**
For the GSL levels data, we first cleaned the North Arm and South Arm datasets separately. Not much cleaning was necessary, we primarily selected and renamed relevant variables, then collapsed the daily water level values into monthly means for each year. The North and South Arms were then merged into one dataset, and the average levels between the two gauges was calculated to give us the main water level values we're interested in.

**Water-Related Land Use**
The water-related land use data started out as separate datasets for difference time periods, and most had slightly different variables. We selected the relevant variables from each to have consistent columns across the datasets, which were then appended into one land use dataset. We then went through the cleaning steps and selected the 9 Utah counties of interest.

**County Resident Populations**
We downloaded this data from FRED for our specific counties of interest, and it came in an already mostly clean .xls file. All that was needed for further cleaning was reading the file into RStudio, converting to long format, extracting year from the date column, and changing some variables names. This data was then merged with the water use data by county and year. Populations were expressed in thousands of people, which we converted by multiplying by 1000 to express it as its actual number.

**Precipitation Data**


**Master Dataset**
To start merging the data into one master dataset, we started with the water use and GSL levels data, and merged these by year and month, since we wanted the average GSL level value for a given year and month. This dataset was then merged with 